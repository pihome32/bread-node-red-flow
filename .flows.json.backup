[{"id":"18b8c7ac.07eee8","type":"tab","label":"Debug","disabled":false,"info":""},{"id":"64672e75.03f4a8","type":"tab","label":"CMD","disabled":false,"info":""},{"id":"c080d81d.548348","type":"tab","label":"Sensor","disabled":false,"info":""},{"id":"d7e822af.c12a4","type":"tab","label":"Main loop","disabled":false,"info":""},{"id":"262612fb.7fef96","type":"tab","label":"FAN","disabled":false,"info":""},{"id":"f3388dca.68aa58","type":"tab","label":"Safety","disabled":false,"info":""},{"id":"604b5693.eede3","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"144fdae.df77825","type":"tab","label":"Screen","disabled":false,"info":""},{"id":"a2c4834c.e7fa58","type":"subflow","name":"Process Simulation","info":"","in":[{"x":37,"y":103,"wires":[{"id":"6d70d582.40d7cc"}]}],"out":[{"x":728.5,"y":294,"wires":[{"id":"9d2669f1.f67b38","port":0}]}]},{"id":"315f1781.9b8a","type":"subflow","name":"Process Simulation (2)","info":"","in":[{"x":37,"y":103,"wires":[{"id":"7572c66e.a49098"}]}],"out":[{"x":728.5,"y":294,"wires":[{"id":"d18bc720.8a5f48","port":0}]}]},{"id":"a8a3abf.e25bad8","type":"subflow","name":"Process Simulation (3)","info":"","in":[{"x":37,"y":103,"wires":[{"id":"64ab43cf.6e5e4c"}]}],"out":[{"x":728.5,"y":294,"wires":[{"id":"11fc8064.92484","port":0}]}]},{"id":"79509665.65e3b8","type":"mqtt-broker","z":"","name":"local","broker":"brocker","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"74dcdab5.83e964","type":"mqtt-broker","z":"","name":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"683f7eec.5c62c","type":"mqtt-broker","z":"","name":"","broker":"http://10.70.1.86","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"ec1a4fd5.087488","type":"serial-port","z":"","serialport":"/dev/ttyACM0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","waitfor":"","dtr":"none","rts":"none","cts":"none","dsr":"none","newline":"4","bin":"false","out":"count","addchar":"","responsetimeout":"10000"},{"id":"4df5a172.d77308","type":"influxdb","z":"18b8c7ac.07eee8","hostname":"influxdb","port":"8086","database":"home","name":"aTimeSeries","usetls":false,"tls":""},{"id":"ddc00501.5975f8","type":"shared-state","z":0,"name":"relay1","lbl":"","tags":"","historyCount":"2","dataType":"bool","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"c8491213.eb9958","type":"shared-state","z":0,"name":"relay3","lbl":"","tags":"","historyCount":"2","dataType":"bool","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"b57179f0.c9eaa","type":"shared-state","z":0,"name":"relay2","lbl":"","tags":"","historyCount":"2","dataType":"bool","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"1dc4d413.03488c","type":"shared-state","z":0,"name":"relay4","lbl":"","tags":"","historyCount":"2","dataType":"bool","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"bff6e5d1.24ce68","type":"shared-state","z":0,"name":"data","lbl":"","tags":"","historyCount":"2","dataType":"obj","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"e06ffb1d.7fc6a","type":"shared-state","z":"","name":"chamberState","lbl":"","tags":"","historyCount":"2","dataType":"num","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"435b10b7.ae825","type":"shared-state","z":0,"name":"chamberMode","lbl":"","tags":"","historyCount":"2","dataType":"str","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"4451538c.85ad4c","type":"shared-state","z":0,"name":"roomTemp","lbl":"","tags":"","historyCount":"2","dataType":"num","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":"C"},{"id":"defdd5c9.00f138","type":"shared-state","z":"","name":"setpoint","lbl":"","tags":"","historyCount":"2","dataType":"num","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"1","numMin":"","numMax":"","unit":"C"},{"id":"6084ef9b.c26b6","type":"shared-state","z":0,"name":"chamberTemp","lbl":"","tags":"","historyCount":"2","dataType":"num","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":"C"},{"id":"15fe707b.cbdd78","type":"shared-state","z":0,"name":"heaterFAN","lbl":"","tags":"","historyCount":"2","dataType":"num","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"84d2f720.b81e98","type":"shared-state","z":0,"name":"coolerFAN","lbl":"","tags":"","historyCount":"2","dataType":"num","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"7cc16dfd.c5bd2c","type":"shared-state","z":0,"name":"distance","lbl":"","tags":"","historyCount":"2","dataType":"num","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"7bda2608.497328","type":"shared-state","z":0,"name":"heaterTemp","lbl":"","tags":"","historyCount":"2","dataType":"num","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":"C"},{"id":"3fd19932.a4ee1e","type":"shared-state","z":0,"name":"DAC","lbl":"","tags":"","historyCount":"2","dataType":"num","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"b7f0356b.50c1a","type":"ui_base","z":0,"theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#008000","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#008000","edited":true},"page-titlebar-backgroundColor":{"value":"#008000","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#333333","edited":false},"group-textColor":{"value":"#00cc00","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#008000","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"1233e7eb.6fcc78","type":"ui_tab","z":0,"name":"Debug","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"258e5760.ba84a8","type":"ui_tab","z":"","name":"Home","icon":"kitchen","order":1,"disabled":false,"hidden":false},{"id":"47847ae6.02444c","type":"ui_group","z":0,"name":"Default","tab":"1233e7eb.6fcc78","order":1,"disp":true,"width":"6","collapse":false},{"id":"97a76c62.524858","type":"ui_group","z":0,"name":"Debug","tab":"1233e7eb.6fcc78","order":2,"disp":true,"width":"6","collapse":false},{"id":"8f8583e.f5aeb8","type":"ui_group","z":0,"name":"State","tab":"1233e7eb.6fcc78","order":3,"disp":true,"width":"6","collapse":false},{"id":"a4b3d3f.f214ab","type":"ui_group","z":0,"name":"State 2","tab":"1233e7eb.6fcc78","order":4,"disp":true,"width":"6","collapse":false},{"id":"fc3775f5.c6257","type":"ui_group","z":"","name":"PID","tab":"258e5760.ba84a8","order":1,"disp":false,"width":14,"collapse":false},{"id":"2319b05c.b5628","type":"semaphore-config","z":0,"name":"","capacity":"1"},{"id":"a8983602.60f12","type":"shared-state","z":"","name":"heaterPID","lbl":"","tags":"","historyCount":"2","dataType":"bool","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"89e0f9c6.9f9cf","type":"shared-state","z":"","name":"coolerPID","lbl":"","tags":"","historyCount":"2","dataType":"bool","boolType":"bool","boolStrTrue":"","boolStrFalse":"","precision":"","numMin":"","numMax":"","unit":""},{"id":"e73674.aa48319","type":"ui_group","z":"","name":"PID","tab":"","order":1,"disp":true,"width":"6"},{"id":"a89998ac.d04bc","type":"ui_group","z":"","name":"Default","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"2270f627.e1bee2","type":"ui_group","z":"","name":"Default","tab":"","order":1,"disp":true,"width":"6"},{"id":"4c0d62a6.5004f4","type":"ui_group","z":"","name":"Full Remote","tab":"","order":1,"disp":true,"width":"3","collapse":false},{"id":"8231b790.49fb6","type":"ui_group","z":"","name":"Heure","tab":"","order":1,"disp":false,"width":"6","collapse":false},{"id":"d483b3b7.e28ac8","type":"ui_tab","z":"","name":"Graph","icon":"show_chart","order":3,"disabled":false,"hidden":false},{"id":"d2fe52dd.9e871","type":"ui_group","z":"","name":"Group 1","tab":"d483b3b7.e28ac8","order":1,"disp":false,"width":"14","collapse":false},{"id":"4d266e28.f2b108","type":"ui_spacer","name":"spacer","group":"fc3775f5.c6257","order":2,"width":2,"height":1},{"id":"5c377975.46851","type":"ui_spacer","name":"spacer","group":"fc3775f5.c6257","order":6,"width":2,"height":1},{"id":"411dde2e.a533a","type":"ui_spacer","name":"spacer","group":"fc3775f5.c6257","order":7,"width":9,"height":1},{"id":"a72050d9.100648","type":"ui_spacer","name":"spacer","group":"fc3775f5.c6257","order":10,"width":6,"height":1},{"id":"7e226e17.100e","type":"ui_spacer","name":"spacer","group":"fc3775f5.c6257","order":11,"width":6,"height":1},{"id":"6bfdf4e0.08db94","type":"ui_spacer","name":"spacer","group":"fc3775f5.c6257","order":12,"width":9,"height":1},{"id":"a6a25e3.8dbbb2","type":"ui_spacer","name":"spacer","group":"fc3775f5.c6257","order":14,"width":10,"height":1},{"id":"472f2b70.fd328c","type":"ui_group","z":"","name":"Radial Gauges","tab":"f581bb25.81589","order":2,"disp":true,"width":"6","collapse":false},{"id":"f581bb25.81589","type":"ui_tab","z":"","name":"Widgets","icon":"dashboard","order":2,"disabled":false,"hidden":true},{"id":"be76bc69.2554b8","type":"inject","z":"18b8c7ac.07eee8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1680,"y":320,"wires":[[]]},{"id":"6a49d89f.1a17e8","type":"mqtt in","z":"c080d81d.548348","name":"","topic":"+/+/+/+/+/chamber/data/roomTemp","qos":"2","datatype":"auto","broker":"74dcdab5.83e964","x":140,"y":120,"wires":[["519dddd5.a6b124"]]},{"id":"464c1ae1.6163b4","type":"mqtt in","z":"c080d81d.548348","name":"","topic":"+/+/+/+/+/chamber/data/chamberTemp","qos":"2","datatype":"auto","broker":"74dcdab5.83e964","x":150,"y":200,"wires":[["3a3d4c6a.26f854"]]},{"id":"4d21aaf7.777404","type":"mqtt in","z":"c080d81d.548348","name":"","topic":"+/+/+/+/+/chamber/data/heaterTemp","qos":"2","datatype":"auto","broker":"74dcdab5.83e964","x":140,"y":280,"wires":[["1814f859.119ea"]]},{"id":"e9bbfe74.dcfd2","type":"mqtt in","z":"c080d81d.548348","name":"","topic":"+/+/+/+/+/chamber/data/distance","qos":"2","datatype":"auto","broker":"74dcdab5.83e964","x":130,"y":360,"wires":[["1a0aeb86.b2dfa4"]]},{"id":"d678235c.eb80c8","type":"switch","z":"d7e822af.c12a4","name":"Target > room Temp","property":"state.setpoint.value","propertyType":"global","rules":[{"t":"gt","v":"state.roomTemp.value","vt":"global"},{"t":"lte","v":"state.roomTemp.value","vt":"global"}],"checkall":"true","repair":false,"outputs":2,"x":540,"y":80,"wires":[["1114f61e.326d72"],["3fbef295.3cfd7e"]]},{"id":"21a843b4.1c08c4","type":"inject","z":"262612fb.7fef96","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":330,"y":200,"wires":[[]]},{"id":"c535bf3e.e05d58","type":"switch","z":"262612fb.7fef96","name":"If mode heating","property":"state.chamberMode.value","propertyType":"global","rules":[{"t":"eq","v":"heating","vt":"str"},{"t":"eq","v":"cooling","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":580,"y":160,"wires":[["98185b60.7616f"],["ac792a78.cec708","6dfa19aa.99285"]]},{"id":"4a072629.46f6c8","type":"switch","z":"262612fb.7fef96","name":"If state IDLE","property":"state.chamberState.value","propertyType":"global","rules":[{"t":"eq","v":"IDLE","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":260,"wires":[["ae8c8725.b155e"]]},{"id":"ac792a78.cec708","type":"change","z":"262612fb.7fef96","name":"Cooler FAN to 200","rules":[{"t":"set","p":"payload","pt":"msg","to":"200","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":220,"wires":[["91f90269.04cf8"]]},{"id":"98185b60.7616f","type":"change","z":"262612fb.7fef96","name":"Cooler FAN to 200","rules":[{"t":"set","p":"payload","pt":"msg","to":"150","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":160,"wires":[["91f90269.04cf8"]]},{"id":"3fbef295.3cfd7e","type":"change","z":"d7e822af.c12a4","name":"cooling","rules":[{"t":"set","p":"payload","pt":"msg","to":"cooling","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":120,"wires":[["281682f5.67d356"]]},{"id":"1114f61e.326d72","type":"change","z":"d7e822af.c12a4","name":"heating","rules":[{"t":"set","p":"payload","pt":"msg","to":"heating","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":60,"wires":[["cb667770.e43778"]]},{"id":"519dddd5.a6b124","type":"json","z":"c080d81d.548348","name":"","property":"payload","action":"","pretty":false,"x":390,"y":120,"wires":[["74f57265.f82724"]]},{"id":"74f57265.f82724","type":"change","z":"c080d81d.548348","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"msg.payload.temperature/100","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":120,"wires":[["17abac16.668be4"]]},{"id":"3a3d4c6a.26f854","type":"json","z":"c080d81d.548348","name":"","property":"payload","action":"","pretty":false,"x":410,"y":200,"wires":[["b1bdd7c1.448ec"]]},{"id":"1814f859.119ea","type":"json","z":"c080d81d.548348","name":"","property":"payload","action":"","pretty":false,"x":390,"y":280,"wires":[["f5a51b2b.e15118"]]},{"id":"1a0aeb86.b2dfa4","type":"json","z":"c080d81d.548348","name":"","property":"payload","action":"","pretty":false,"x":370,"y":360,"wires":[["633b83d9.9c207c"]]},{"id":"b1bdd7c1.448ec","type":"change","z":"c080d81d.548348","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"msg.payload.temperature/100","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":200,"wires":[["1bb22e0e.5a2d4a"]]},{"id":"f5a51b2b.e15118","type":"change","z":"c080d81d.548348","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"msg.payload.temperature/100","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":280,"wires":[["9582e8db.d8e608"]]},{"id":"633b83d9.9c207c","type":"change","z":"c080d81d.548348","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"msg.payload.distance","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":360,"wires":[["918c5608.5db458"]]},{"id":"ae8c8725.b155e","type":"change","z":"262612fb.7fef96","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":340,"wires":[["9291b804.1789e8","91f90269.04cf8"]]},{"id":"6dfa19aa.99285","type":"change","z":"262612fb.7fef96","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"255","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":260,"wires":[["9291b804.1789e8"]]},{"id":"30026e01.59ef02","type":"function","z":"a2c4834c.e7fa58","name":"30 sec RC + 20","func":"// Applies a simple RC low pass filter to incoming payload values\nvar tc = 30*1000;       // time constant in milliseconds\n\nvar lastValue = context.get('lastValue');\nif (typeof lastValue == \"undefined\") lastValue = msg.payload;\nvar lastTime = context.get('lastTime') || null;\nvar now = new Date();\nvar currentValue = msg.payload;\nif (lastTime === null) {\n    // first time through\n    newValue = currentValue;\n} else {\n    var dt = now - lastTime;\n    var newValue;\n    \n    if (dt > 0) {\n        var dtotc = dt / tc;\n        newValue = lastValue * (1 - dtotc) + currentValue * dtotc;\n    } else {\n        // no time has elapsed leave output the same as last time\n        newValue = lastValue;\n    }\n}\ncontext.set('lastValue', newValue);\ncontext.set('lastTime', now);\n\nmsg.payload = newValue + 20;\nreturn msg;","outputs":1,"noerr":0,"x":626.5,"y":207,"wires":[["9d2669f1.f67b38"]]},{"id":"fcdbb78b.ec6bb8","type":"inject","z":"a2c4834c.e7fa58","name":"Inject -0.2 at start","repeat":"","crontab":"","once":true,"topic":"","payload":"-0.2","payloadType":"num","x":134.5,"y":30,"wires":[["6d70d582.40d7cc"]]},{"id":"d2f1bf16.20b18","type":"function","z":"a2c4834c.e7fa58","name":"10 sec RC","func":"// Applies a simple RC low pass filter to incoming payload values\nvar tc = 10*1000;       // time constant in milliseconds\n\nvar lastValue = context.get('lastValue');\nif (typeof lastValue == \"undefined\") lastValue = msg.payload;\nvar lastTime = context.get('lastTime') || null;\nvar now = new Date();\nvar currentValue = msg.payload;\nif (lastTime === null) {\n    // first time through\n    newValue = currentValue;\n} else {\n    var dt = now - lastTime;\n    var newValue;\n    \n    if (dt > 0) {\n        var dtotc = dt / tc;\n        newValue = lastValue * (1 - dtotc) + currentValue * dtotc;\n    } else {\n        // no time has elapsed leave output the same as last time\n        newValue = lastValue;\n    }\n}\ncontext.set('lastValue', newValue);\ncontext.set('lastTime', now);\n\nmsg.payload = newValue;\nreturn msg;","outputs":1,"noerr":0,"x":451,"y":207,"wires":[["30026e01.59ef02"]]},{"id":"6d70d582.40d7cc","type":"delay","z":"a2c4834c.e7fa58","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":268,"y":104,"wires":[["7e41515a.444e38"]]},{"id":"48bba734.cb2b7","type":"function","z":"a2c4834c.e7fa58","name":"2 msg transport delay","func":"// stores messages in a fifo until the specified number have been received, \n// then releases them as new messages are received.\n// during the filling phase the earliest message is passed on each time \n// a message is received, but it is also left in the fifo\nvar fifoMaxLength = 2;\nvar fifo = context.get('fifo') || [];\n// push the new message onto the top of the array, messages are shifted down and\n// drop off the front\nvar length = fifo.push(msg);  // returns new length\nif (length > fifoMaxLength) {\n    newMsg = fifo.shift();\n} else {\n    // not full yet, make a copy of the msg and pass it on\n    var newMsg = JSON.parse(JSON.stringify(fifo[0]));\n}\ncontext.set('fifo', fifo);\nreturn newMsg;","outputs":1,"noerr":0,"x":258,"y":208,"wires":[["d2f1bf16.20b18"]]},{"id":"9d2669f1.f67b38","type":"function","z":"a2c4834c.e7fa58","name":"Clear all except payload","func":"msg2 = {payload: msg.payload};\nreturn msg2;","outputs":1,"noerr":0,"x":545,"y":293,"wires":[[]]},{"id":"7e41515a.444e38","type":"range","z":"a2c4834c.e7fa58","minin":"0","maxin":"1","minout":"0","maxout":"100","action":"scale","round":false,"name":"","x":87,"y":208,"wires":[["48bba734.cb2b7"]]},{"id":"7bb1e955.a8d99","type":"range","z":"d7e822af.c12a4","minin":"0","maxin":"1","minout":"2150","maxout":"1700","action":"scale","round":false,"property":"payload","name":"","x":1330,"y":600,"wires":[["f095adee.1b77c"]]},{"id":"a4506f1b.f1adb8","type":"mqtt out","z":"d7e822af.c12a4","name":"","topic":"","qos":"","retain":"","broker":"74dcdab5.83e964","x":1550,"y":540,"wires":[]},{"id":"97674649.be05e8","type":"function","z":"d7e822af.c12a4","name":"","func":"\nvar data = {};\ndata.pv = msg.pv;\ndata.proportional= msg.proportional;\ndata.integral = msg.instegral;\ndata.derivative = msg.derivative;\ndata.smothed_value= msg.smothed_value;\ndata.PID = msg.payload;\nmsg.payload= data;\nmsg.topic=\"PID/cooling\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":500,"wires":[["a4506f1b.f1adb8"]]},{"id":"d9796f07.209298","type":"change","z":"64672e75.03f4a8","name":"Prepare message for relay","rules":[{"t":"change","p":"topic","pt":"msg","from":"relay","fromt":"str","to":"state/relay","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.state","pt":"msg","to":"value","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":280,"wires":[["e33b4447.edd14"]]},{"id":"2edb92ac.0ac33e","type":"mqtt out","z":"64672e75.03f4a8","name":"","topic":"","qos":"","retain":"","broker":"74dcdab5.83e964","x":1150,"y":280,"wires":[]},{"id":"7392209e.bcb3e","type":"switch","z":"64672e75.03f4a8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":280,"wires":[["dc72ebdb.0ab3b"],["d7452f76.e27978"]]},{"id":"d7452f76.e27978","type":"change","z":"64672e75.03f4a8","name":"","rules":[{"t":"set","p":"value","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":300,"wires":[["d9796f07.209298"]]},{"id":"dc72ebdb.0ab3b","type":"change","z":"64672e75.03f4a8","name":"","rules":[{"t":"set","p":"value","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":240,"wires":[["d9796f07.209298"]]},{"id":"e33b4447.edd14","type":"json","z":"64672e75.03f4a8","name":"","property":"payload","action":"","pretty":false,"x":970,"y":280,"wires":[["2edb92ac.0ac33e"]]},{"id":"1e8f4cd1.7b9e23","type":"change","z":"64672e75.03f4a8","name":"Prepare message for DAC","rules":[{"t":"set","p":"temp","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.DAC","pt":"msg","to":"temp","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"state/DAC","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":360,"wires":[["e33b4447.edd14"]]},{"id":"b56e2773.31a2c8","type":"inject","z":"c080d81d.548348","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"4","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":680,"wires":[["8281097c.662558","39d7cb78.f294ec","8b24da22.64019","951c2117.6da39","c9c4189a.75f2c","2f25ad6f.d8f582"]]},{"id":"a78c11d9.9d329","type":"mqtt out","z":"c080d81d.548348","name":"","topic":"","qos":"","retain":"","broker":"74dcdab5.83e964","x":930,"y":660,"wires":[]},{"id":"3bf4ab79.fee764","type":"json","z":"c080d81d.548348","name":"","property":"payload","action":"","pretty":false,"x":750,"y":660,"wires":[["a78c11d9.9d329"]]},{"id":"8281097c.662558","type":"change","z":"c080d81d.548348","name":"Prepare message for relay 1","rules":[{"t":"set","p":"topic","pt":"msg","to":"state/relay1","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.state","pt":"msg","to":"state.relay1.value","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":640,"wires":[["3bf4ab79.fee764"]]},{"id":"39d7cb78.f294ec","type":"change","z":"c080d81d.548348","name":"Prepare message for relay 2","rules":[{"t":"set","p":"topic","pt":"msg","to":"state/relay2","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.state","pt":"msg","to":"state.relay2.value","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":700,"wires":[["3bf4ab79.fee764"]]},{"id":"8b24da22.64019","type":"change","z":"c080d81d.548348","name":"Prepare message for relay 3","rules":[{"t":"set","p":"topic","pt":"msg","to":"state/relay3","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.state","pt":"msg","to":"state.relay3.value","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":760,"wires":[["3bf4ab79.fee764"]]},{"id":"951c2117.6da39","type":"change","z":"c080d81d.548348","name":"Prepare message for relay 4","rules":[{"t":"set","p":"topic","pt":"msg","to":"state/relay4","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.state","pt":"msg","to":"state.relay4.value","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":800,"wires":[["3bf4ab79.fee764"]]},{"id":"c9c4189a.75f2c","type":"change","z":"c080d81d.548348","name":"Prepare message for DAC","rules":[{"t":"set","p":"topic","pt":"msg","to":"state/DAC","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.DAC","pt":"msg","to":"state.DAC.value","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":940,"wires":[["3bf4ab79.fee764"]]},{"id":"6a03f1fe.07ee6","type":"change","z":"d7e822af.c12a4","name":"Enable","rules":[{"t":"set","p":"enable","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"setpoint","pt":"msg","to":"state.setpoint.value","tot":"global"},{"t":"set","p":"state.heaterPID.value","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":440,"wires":[["a3d4333b.6db588"]]},{"id":"a1ee4f29.bb8d38","type":"function","z":"d7e822af.c12a4","name":"","func":"\nvar data = {};\ndata.pv = msg.pv;\ndata.proportional= msg.proportional;\ndata.integral = msg.instegral;\ndata.derivative = msg.derivative;\ndata.smothed_value= msg.smothed_value;\ndata.PID = msg.payload;\nmsg.payload= data;\nmsg.topic=\"PID/heating\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":680,"wires":[["a4506f1b.f1adb8"]]},{"id":"1ee5d6c.4e64429","type":"range","z":"d7e822af.c12a4","minin":"0","maxin":"1","minout":"2100","maxout":"1700","action":"scale","round":false,"property":"payload","name":"","x":1310,"y":740,"wires":[["f095adee.1b77c"]]},{"id":"2f25ad6f.d8f582","type":"change","z":"c080d81d.548348","name":"Prepare message for setpoint","rules":[{"t":"set","p":"topic","pt":"msg","to":"state/setpoint","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.setpoint","pt":"msg","to":"state.setpoint.value","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":980,"wires":[["3bf4ab79.fee764"]]},{"id":"3288ec43.4f261c","type":"debug","z":"c080d81d.548348","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1110,"y":580,"wires":[]},{"id":"93fb3f24.682bf","type":"switch","z":"d7e822af.c12a4","name":"If PID = 0","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1180,"y":780,"wires":[["c66d9bf6.ffa0c8"],["5366782c.f71b2"]]},{"id":"c66d9bf6.ffa0c8","type":"change","z":"d7e822af.c12a4","name":"2","rules":[{"t":"set","p":"payload","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1490,"y":760,"wires":[["b4f615d6.3463e8"]]},{"id":"5366782c.f71b2","type":"change","z":"d7e822af.c12a4","name":"3","rules":[{"t":"set","p":"payload","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1430,"y":820,"wires":[["b4f615d6.3463e8"]]},{"id":"bf75b64e.6b2288","type":"function","z":"315f1781.9b8a","name":"30 sec RC + 20","func":"// Applies a simple RC low pass filter to incoming payload values\nvar tc = 30*1000;       // time constant in milliseconds\n\nvar lastValue = context.get('lastValue');\nif (typeof lastValue == \"undefined\") lastValue = msg.payload;\nvar lastTime = context.get('lastTime') || null;\nvar now = new Date();\nvar currentValue = msg.payload;\nif (lastTime === null) {\n    // first time through\n    newValue = currentValue;\n} else {\n    var dt = now - lastTime;\n    var newValue;\n    \n    if (dt > 0) {\n        var dtotc = dt / tc;\n        newValue = lastValue * (1 - dtotc) + currentValue * dtotc;\n    } else {\n        // no time has elapsed leave output the same as last time\n        newValue = lastValue;\n    }\n}\ncontext.set('lastValue', newValue);\ncontext.set('lastTime', now);\n\nmsg.payload = newValue + 20;\nreturn msg;","outputs":1,"noerr":0,"x":626.5,"y":207,"wires":[["d18bc720.8a5f48"]]},{"id":"8b13dab8.5b111","type":"inject","z":"315f1781.9b8a","name":"Inject -0.2 at start","repeat":"","crontab":"","once":true,"topic":"","payload":"-0.2","payloadType":"num","x":134.5,"y":30,"wires":[["7572c66e.a49098"]]},{"id":"6a59c527.82190c","type":"function","z":"315f1781.9b8a","name":"10 sec RC","func":"// Applies a simple RC low pass filter to incoming payload values\nvar tc = 10*1000;       // time constant in milliseconds\n\nvar lastValue = context.get('lastValue');\nif (typeof lastValue == \"undefined\") lastValue = msg.payload;\nvar lastTime = context.get('lastTime') || null;\nvar now = new Date();\nvar currentValue = msg.payload;\nif (lastTime === null) {\n    // first time through\n    newValue = currentValue;\n} else {\n    var dt = now - lastTime;\n    var newValue;\n    \n    if (dt > 0) {\n        var dtotc = dt / tc;\n        newValue = lastValue * (1 - dtotc) + currentValue * dtotc;\n    } else {\n        // no time has elapsed leave output the same as last time\n        newValue = lastValue;\n    }\n}\ncontext.set('lastValue', newValue);\ncontext.set('lastTime', now);\n\nmsg.payload = newValue;\nreturn msg;","outputs":1,"noerr":0,"x":451,"y":207,"wires":[["bf75b64e.6b2288"]]},{"id":"7572c66e.a49098","type":"delay","z":"315f1781.9b8a","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":268,"y":104,"wires":[["f06fb8ea.421cd"]]},{"id":"7febaf3c.f11928","type":"function","z":"315f1781.9b8a","name":"2 msg transport delay","func":"// stores messages in a fifo until the specified number have been received, \n// then releases them as new messages are received.\n// during the filling phase the earliest message is passed on each time \n// a message is received, but it is also left in the fifo\nvar fifoMaxLength = 2;\nvar fifo = context.get('fifo') || [];\n// push the new message onto the top of the array, messages are shifted down and\n// drop off the front\nvar length = fifo.push(msg);  // returns new length\nif (length > fifoMaxLength) {\n    newMsg = fifo.shift();\n} else {\n    // not full yet, make a copy of the msg and pass it on\n    var newMsg = JSON.parse(JSON.stringify(fifo[0]));\n}\ncontext.set('fifo', fifo);\nreturn newMsg;","outputs":1,"noerr":0,"x":258,"y":208,"wires":[["6a59c527.82190c"]]},{"id":"d18bc720.8a5f48","type":"function","z":"315f1781.9b8a","name":"Clear all except payload","func":"msg2 = {payload: msg.payload};\nreturn msg2;","outputs":1,"noerr":0,"x":545,"y":293,"wires":[[]]},{"id":"f06fb8ea.421cd","type":"range","z":"315f1781.9b8a","minin":"0","maxin":"1","minout":"0","maxout":"100","action":"scale","round":false,"name":"","x":87,"y":208,"wires":[["7febaf3c.f11928"]]},{"id":"850d8f8b.df11f8","type":"inject","z":"d7e822af.c12a4","name":"Send chamber temp","props":[{"p":"payload"},{"p":"setpoint","v":"state.setpoint.value","vt":"global"}],"repeat":"3","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"state.chamberTemp.value","payloadType":"global","x":120,"y":240,"wires":[["f9574f52.8fd858","d5681a9f.d2114"]]},{"id":"f9574f52.8fd858","type":"switch","z":"d7e822af.c12a4","name":"","property":"state.chamberState.value","propertyType":"global","rules":[{"t":"gt","v":"1","vt":"str"},{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":230,"y":400,"wires":[["156abe84.ea5089"],["6aa10673.5907b8"]]},{"id":"6aa10673.5907b8","type":"change","z":"d7e822af.c12a4","name":"Disable","rules":[{"t":"set","p":"enable","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"test","pt":"msg","to":"0","tot":"str"},{"t":"set","p":"state.coolerPID.value","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"state.heaterPID.value","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":500,"wires":[["a3d4333b.6db588","596ca967.814d6"]]},{"id":"156abe84.ea5089","type":"switch","z":"d7e822af.c12a4","name":"","property":"state.chamberMode.value","propertyType":"global","rules":[{"t":"eq","v":"cooling","vt":"str"},{"t":"eq","v":"heating","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":350,"y":320,"wires":[["7ac50680.a033c","c24bb1e5.e7b27"],["cf613a24.25223","6a03f1fe.07ee6"]]},{"id":"c24bb1e5.e7b27","type":"change","z":"d7e822af.c12a4","name":"Enable","rules":[{"t":"set","p":"enable","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"setpoint","pt":"msg","to":"state.setpoint.value","tot":"global"},{"t":"set","p":"payload","pt":"msg","to":"setpoint+setpoint-payload","tot":"jsonata"},{"t":"set","p":"state.coolerPID.value","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":320,"wires":[["596ca967.814d6"]]},{"id":"cf613a24.25223","type":"change","z":"d7e822af.c12a4","name":"Disable","rules":[{"t":"set","p":"enable","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"state.coolerPID.value","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":400,"wires":[["596ca967.814d6"]]},{"id":"7ac50680.a033c","type":"change","z":"d7e822af.c12a4","name":"Disable","rules":[{"t":"set","p":"enable","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"state.heaterPID.value","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":280,"wires":[["a3d4333b.6db588"]]},{"id":"ae3137f7.fc82d","type":"debug","z":"f3388dca.68aa58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1230,"y":420,"wires":[]},{"id":"6b3bc3fc.9f00a4","type":"serial in","z":"f3388dca.68aa58","name":"","serial":"ec1a4fd5.087488","x":210,"y":160,"wires":[[]]},{"id":"fe51aa72.2f3fa8","type":"serial out","z":"f3388dca.68aa58","name":"","serial":"ec1a4fd5.087488","x":940,"y":320,"wires":[]},{"id":"19f65c50.933f64","type":"switch","z":"f3388dca.68aa58","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"SHUT","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":450,"y":160,"wires":[["b87c4996.042d98"]]},{"id":"78a91a0a.09e144","type":"mqtt in","z":"f3388dca.68aa58","name":"","topic":"+/+/+/+/+/chamber/data/chamberTemp","qos":"2","datatype":"auto","broker":"74dcdab5.83e964","x":150,"y":280,"wires":[["67ea752.88f2b0c","7b64e413.ab1234","8ed599a0.780228"]]},{"id":"67ea752.88f2b0c","type":"change","z":"f3388dca.68aa58","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[0]","tot":"bin"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":300,"wires":[[]]},{"id":"7b64e413.ab1234","type":"trigger","z":"f3388dca.68aa58","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"20","extend":true,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":450,"y":420,"wires":[["5e56dbea.04ddfc"]]},{"id":"5e56dbea.04ddfc","type":"exec","z":"f3388dca.68aa58","command":"sudo systemctl restart tinkerforge_mqtt.service","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":870,"y":440,"wires":[["ae3137f7.fc82d"],["ae3137f7.fc82d"],[]]},{"id":"efbcaa12.9859f","type":"inject","z":"f3388dca.68aa58","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":140,"y":420,"wires":[["c9de36e4.6c62e","82e0509d.446518"]]},{"id":"c9de36e4.6c62e","type":"switch","z":"f3388dca.68aa58","name":"If chamber temp > 35","property":"state.chamberTemp.value","propertyType":"global","rules":[{"t":"gt","v":"45","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":380,"y":520,"wires":[["9a4649cc.d8b6b8"]]},{"id":"9a4649cc.d8b6b8","type":"change","z":"f3388dca.68aa58","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[9]","tot":"bin"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":520,"wires":[["fe51aa72.2f3fa8"]]},{"id":"b87c4996.042d98","type":"exec","z":"f3388dca.68aa58","command":"sudo shutdown now","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1120,"y":220,"wires":[[],[],[]]},{"id":"e8736c8e.4bf1b","type":"change","z":"18b8c7ac.07eee8","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"[9]","tot":"bin"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":380,"wires":[["4ef20a2.dfce174"]]},{"id":"2caf95aa.06a26a","type":"debug","z":"f3388dca.68aa58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":720,"y":140,"wires":[]},{"id":"4ef20a2.dfce174","type":"link out","z":"18b8c7ac.07eee8","name":"send-switch-off","links":["e3b617d9.1e80f"],"x":1005,"y":460,"wires":[]},{"id":"e3b617d9.1e80f","type":"link in","z":"f3388dca.68aa58","name":"","links":["4ef20a2.dfce174","c03a4710.1bffe8"],"x":515,"y":360,"wires":[["fe51aa72.2f3fa8","b87c4996.042d98"]]},{"id":"a685162b.51345","type":"inject","z":"64672e75.03f4a8","name":"Paper initiate","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"2","topic":"","payload":"","payloadType":"date","x":280,"y":860,"wires":[[]]},{"id":"108e9856.4a1578","type":"mqtt out","z":"64672e75.03f4a8","name":"","topic":"","qos":"","retain":"","broker":"74dcdab5.83e964","x":1130,"y":840,"wires":[]},{"id":"ecc0623d.1b9d68","type":"change","z":"64672e75.03f4a8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"color\":\"white\"}","tot":"json"},{"t":"set","p":"topic","pt":"msg","to":"tinkerforge/request/e_paper_296x128_bricklet/LwN/fill_display","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":860,"wires":[["108e9856.4a1578","a25eb1c4.b39b78"]]},{"id":"e16a33fc.62b038","type":"change","z":"64672e75.03f4a8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"color\":\"white\"}","tot":"json"},{"t":"set","p":"topic","pt":"msg","to":"tinkerforge/request/e_paper_296x128_bricklet/LwN/draw","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":960,"wires":[["108e9856.4a1578"]]},{"id":"a25eb1c4.b39b78","type":"delay","z":"64672e75.03f4a8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":680,"y":900,"wires":[["e16a33fc.62b038"]]},{"id":"9bc897c7.273c6","type":"inject","z":"64672e75.03f4a8","name":"Paper update","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"120","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":960,"wires":[[]]},{"id":"f4c31b4a.411968","type":"change","z":"64672e75.03f4a8","name":"","rules":[{"t":"set","p":"setpoint","pt":"msg","to":"state.setpoint.value","tot":"global"},{"t":"set","p":"chamber","pt":"msg","to":"state.chamberTemp.value","tot":"global"},{"t":"set","p":"state","pt":"msg","to":"state.chamberState.value","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":1000,"wires":[["27e51d40.9e02d2"]]},{"id":"27e51d40.9e02d2","type":"template","z":"64672e75.03f4a8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{setpoint}} {{chamber}} {{state}}","output":"str","x":500,"y":1000,"wires":[["8036e421.f8b8c8","c4c9770c.ccc0b"]]},{"id":"8036e421.f8b8c8","type":"exec","z":"64672e75.03f4a8","command":"python3 ~/bread-tinkerforge/paper.py","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"paper control","x":1020,"y":1020,"wires":[[],[],[]]},{"id":"c4c9770c.ccc0b","type":"debug","z":"64672e75.03f4a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":840,"y":1140,"wires":[]},{"id":"596ca967.814d6","type":"PID","z":"d7e822af.c12a4","name":"Cooler PID","setpoint":21,"pb":"1.5","ti":"120","td":"20","integral_default":"0.1","smooth_factor":3,"max_interval":600,"enable":"0","disabled_op":0,"x":910,"y":380,"wires":[["7a372047.0c825"]]},{"id":"a3d4333b.6db588","type":"PID","z":"d7e822af.c12a4","name":"Heater PID","setpoint":"20","pb":"1.3","ti":"600","td":"150","integral_default":"0","smooth_factor":"2","max_interval":600,"enable":"0","disabled_op":"0","x":790,"y":580,"wires":[["67048c6a.78d4bc"]]},{"id":"1ce3c7b3.9d5738","type":"set-shared-state","z":"18b8c7ac.07eee8","state":"ddc00501.5975f8","name":"relay1","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":730,"y":580,"wires":[]},{"id":"8eef0fa8.a2597","type":"set-shared-state","z":"18b8c7ac.07eee8","state":"b57179f0.c9eaa","name":"relay2","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":730,"y":640,"wires":[]},{"id":"2f1963d8.e2c8b4","type":"set-shared-state","z":"18b8c7ac.07eee8","state":"e06ffb1d.7fc6a","name":"chamberState","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":820,"y":320,"wires":[]},{"id":"9db1a745.e4a1e8","type":"set-shared-state","z":"18b8c7ac.07eee8","state":"e06ffb1d.7fc6a","name":"chamberState","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":800,"y":240,"wires":[]},{"id":"49589999.04ef2","type":"set-shared-state","z":"18b8c7ac.07eee8","state":"defdd5c9.00f138","name":"setpoint","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":780,"y":180,"wires":[]},{"id":"918c5608.5db458","type":"set-shared-state","z":"c080d81d.548348","state":"7cc16dfd.c5bd2c","name":"distance","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":800,"y":360,"wires":[]},{"id":"9582e8db.d8e608","type":"set-shared-state","z":"c080d81d.548348","state":"7bda2608.497328","name":"heaterTemp","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":790,"y":280,"wires":[]},{"id":"1bb22e0e.5a2d4a","type":"set-shared-state","z":"c080d81d.548348","state":"6084ef9b.c26b6","name":"chamberTemp","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":800,"y":200,"wires":[]},{"id":"17abac16.668be4","type":"set-shared-state","z":"c080d81d.548348","state":"4451538c.85ad4c","name":"roomTemp","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":750,"y":120,"wires":[]},{"id":"6e474a8a.4696a4","type":"set-shared-state","z":"18b8c7ac.07eee8","state":"3fd19932.a4ee1e","name":"DAC","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":690,"y":760,"wires":[]},{"id":"281682f5.67d356","type":"set-shared-state","z":"d7e822af.c12a4","state":"435b10b7.ae825","name":"chamberMode","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":1040,"y":120,"wires":[]},{"id":"91f90269.04cf8","type":"set-shared-state","z":"262612fb.7fef96","state":"84d2f720.b81e98","name":"coolerFAN","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":1170,"y":200,"wires":[]},{"id":"9291b804.1789e8","type":"set-shared-state","z":"262612fb.7fef96","state":"15fe707b.cbdd78","name":"heaterFAN","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":1210,"y":300,"wires":[]},{"id":"f095adee.1b77c","type":"set-shared-state","z":"d7e822af.c12a4","state":"3fd19932.a4ee1e","name":"DAC","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":1590,"y":680,"wires":[]},{"id":"a3f4cfa0.4c2fd8","type":"get-shared-state","z":"64672e75.03f4a8","state":"ddc00501.5975f8","name":"relay1","triggerOnInit":true,"x":110,"y":120,"wires":[["4441a7ff.ccde"]]},{"id":"fff30cf1.14895","type":"get-shared-state","z":"64672e75.03f4a8","state":"b57179f0.c9eaa","name":"relay2","triggerOnInit":true,"x":110,"y":180,"wires":[["4441a7ff.ccde"]]},{"id":"e20d799d.7e8f18","type":"get-shared-state","z":"d7e822af.c12a4","state":"e06ffb1d.7fc6a","name":"chamberState","triggerOnInit":true,"x":70,"y":60,"wires":[["4bc853ce.08eac4"]]},{"id":"a333f935.428908","type":"get-shared-state","z":"c080d81d.548348","state":"e06ffb1d.7fc6a","name":"chamberState","triggerOnInit":true,"x":290,"y":480,"wires":[["7fd27d8a.bcbbf4"]]},{"id":"11be11a2.727b5e","type":"get-shared-state","z":"c080d81d.548348","state":"defdd5c9.00f138","name":"setpoint","triggerOnInit":true,"x":270,"y":560,"wires":[["91397816.339fe8"]]},{"id":"6548dc38.868a44","type":"get-shared-state","z":"c080d81d.548348","state":"7cc16dfd.c5bd2c","name":"distance","triggerOnInit":true,"x":1000,"y":360,"wires":[["7ed7f97c.15ae4"]]},{"id":"7f71b06f.1dbde","type":"get-shared-state","z":"c080d81d.548348","state":"6084ef9b.c26b6","name":"chamberTemp","triggerOnInit":true,"x":1040,"y":200,"wires":[["718c84c2.7e250c","c51f5e58.5226f"]]},{"id":"282f76de.2287ca","type":"get-shared-state","z":"c080d81d.548348","state":"4451538c.85ad4c","name":"roomTemp","triggerOnInit":true,"x":920,"y":120,"wires":[["5acae9e9.867408"]]},{"id":"ddaa2721.6d98a","type":"get-shared-state","z":"64672e75.03f4a8","state":"3fd19932.a4ee1e","name":"DAC","triggerOnInit":true,"x":150,"y":360,"wires":[["1e8f4cd1.7b9e23","35d58b7b.e4a0bc"]]},{"id":"8e1f6ff7.d2bf8","type":"get-shared-state","z":"c080d81d.548348","state":"3fd19932.a4ee1e","name":"DAC","triggerOnInit":true,"x":850,"y":460,"wires":[["621e6eb8.feb82"]]},{"id":"5ed6831d.43f904","type":"get-shared-state","z":"18b8c7ac.07eee8","state":"ddc00501.5975f8","name":"relay1","triggerOnInit":true,"x":240,"y":600,"wires":[["7349f45.777760c"]]},{"id":"99d370b6.0352a8","type":"get-shared-state","z":"18b8c7ac.07eee8","state":"b57179f0.c9eaa","name":"relay2","triggerOnInit":true,"x":240,"y":660,"wires":[["bdc3a7cc.6ca24"]]},{"id":"e2296a40.adbd08","type":"get-shared-state","z":"18b8c7ac.07eee8","state":"defdd5c9.00f138","name":"setpoint","triggerOnInit":true,"x":230,"y":180,"wires":[["733b3cd.a2b6944"]]},{"id":"d3770024.219b48","type":"get-shared-state","z":"18b8c7ac.07eee8","state":"3fd19932.a4ee1e","name":"DAC","triggerOnInit":true,"x":230,"y":760,"wires":[["51d9b5f6.707fb4"]]},{"id":"7349f45.777760c","type":"ui_switch","z":"18b8c7ac.07eee8","name":"","label":"Relay 1","tooltip":"","group":"97a76c62.524858","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":500,"y":580,"wires":[["1ce3c7b3.9d5738"]]},{"id":"bdc3a7cc.6ca24","type":"ui_switch","z":"18b8c7ac.07eee8","name":"","label":"Relay 2","tooltip":"","group":"97a76c62.524858","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"photon/cmd/Relay","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":500,"y":640,"wires":[["8eef0fa8.a2597"]]},{"id":"ab18f573.78581","type":"ui_button","z":"18b8c7ac.07eee8","name":"","group":"47847ae6.02444c","order":2,"width":0,"height":0,"passthru":false,"label":"Start","tooltip":"","color":"","bgcolor":"","icon":"","payload":"2","payloadType":"num","topic":"","x":530,"y":320,"wires":[["2f1963d8.e2c8b4"]]},{"id":"43953858.aaf258","type":"ui_button","z":"18b8c7ac.07eee8","name":"","group":"47847ae6.02444c","order":3,"width":0,"height":0,"passthru":false,"label":"Stop","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"num","topic":"","x":530,"y":240,"wires":[["9db1a745.e4a1e8"]]},{"id":"eb7dc749.104ee8","type":"ui_button","z":"18b8c7ac.07eee8","name":"","group":"47847ae6.02444c","order":4,"width":0,"height":0,"passthru":false,"label":"Switch OFF","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"num","topic":"","x":550,"y":380,"wires":[["9db1a745.e4a1e8","e8736c8e.4bf1b"]]},{"id":"718c84c2.7e250c","type":"ui_gauge","z":"c080d81d.548348","name":"","group":"8f8583e.f5aeb8","order":1,"width":0,"height":0,"gtype":"gage","title":"Chamber Temp","label":"units","format":"{{value}}","min":"10","max":"40","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1220,"y":200,"wires":[]},{"id":"5acae9e9.867408","type":"ui_gauge","z":"c080d81d.548348","name":"","group":"8f8583e.f5aeb8","order":2,"width":0,"height":0,"gtype":"gage","title":"Room Temp","label":"units","format":"{{value}}","min":"15","max":"40","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1150,"y":120,"wires":[]},{"id":"91397816.339fe8","type":"ui_gauge","z":"c080d81d.548348","name":"","group":"8f8583e.f5aeb8","order":3,"width":0,"height":0,"gtype":"gage","title":"Setpoint","label":"units","format":"{{value}}","min":"10","max":"35","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":680,"y":540,"wires":[]},{"id":"7ed7f97c.15ae4","type":"ui_text","z":"c080d81d.548348","group":"8f8583e.f5aeb8","order":4,"width":0,"height":0,"name":"","label":"Distance","format":"{{msg.payload}}","layout":"row-spread","x":1200,"y":360,"wires":[]},{"id":"621e6eb8.feb82","type":"ui_text","z":"c080d81d.548348","group":"8f8583e.f5aeb8","order":4,"width":0,"height":0,"name":"","label":"DAC","format":"{{msg.payload}}","layout":"row-spread","x":1190,"y":460,"wires":[]},{"id":"7fd27d8a.bcbbf4","type":"ui_text","z":"c080d81d.548348","group":"a4b3d3f.f214ab","order":4,"width":0,"height":0,"name":"","label":"State","format":"{{msg.payload}}","layout":"row-spread","x":650,"y":460,"wires":[]},{"id":"733b3cd.a2b6944","type":"ui_numeric","z":"18b8c7ac.07eee8","name":"","label":"Target temperature","tooltip":"","group":"47847ae6.02444c","order":1,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":"10","max":"40","step":"0.5","x":550,"y":180,"wires":[["49589999.04ef2"]]},{"id":"51d9b5f6.707fb4","type":"ui_numeric","z":"18b8c7ac.07eee8","name":"","label":"DAC","tooltip":"","group":"97a76c62.524858","order":7,"width":0,"height":0,"wrap":false,"passthru":false,"topic":"photon/cmd/DAC","format":"{{value}}","min":"1500","max":"3300","step":"1","x":490,"y":740,"wires":[["6e474a8a.4696a4"]]},{"id":"cf743fb7.d46fa8","type":"debug","z":"c080d81d.548348","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":500,"y":40,"wires":[]},{"id":"16f7e6a.9134a19","type":"comment","z":"f3388dca.68aa58","name":"","info":"State\n1 Stand by\n2 IDLE\n3 heating\n4 cooling","x":310,"y":60,"wires":[]},{"id":"82e0509d.446518","type":"change","z":"f3388dca.68aa58","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"state.chamberState.value","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":580,"wires":[["753f8476.c35ca4"]]},{"id":"753f8476.c35ca4","type":"function","z":"f3388dca.68aa58","name":"Convert to buffer","func":"msg.payload = Buffer.from([msg.payload]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":580,"wires":[["fe51aa72.2f3fa8"]]},{"id":"7add9e73.95bd5","type":"inject","z":"f3388dca.68aa58","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":360,"wires":[["7b64e413.ab1234"]]},{"id":"8ed599a0.780228","type":"trigger","z":"f3388dca.68aa58","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"3","extend":true,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":730,"y":220,"wires":[["b87c4996.042d98","5f52150e.574fcc"]]},{"id":"e40544cf.a5d998","type":"set-shared-state","z":"f3388dca.68aa58","state":"e06ffb1d.7fc6a","name":"chamberState","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":1110,"y":120,"wires":[]},{"id":"5f52150e.574fcc","type":"change","z":"f3388dca.68aa58","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":160,"wires":[["e40544cf.a5d998"]]},{"id":"cb667770.e43778","type":"set-shared-state","z":"d7e822af.c12a4","state":"435b10b7.ae825","name":"chamberMode","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":1040,"y":60,"wires":[]},{"id":"b4f615d6.3463e8","type":"set-shared-state","z":"d7e822af.c12a4","state":"e06ffb1d.7fc6a","name":"chamberState","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":1740,"y":760,"wires":[]},{"id":"a5faa198.dc456","type":"get-shared-state","z":"64672e75.03f4a8","state":"e06ffb1d.7fc6a","name":"chamberState","triggerOnInit":true,"x":90,"y":580,"wires":[["4ba42455.672e5c"]]},{"id":"4ba42455.672e5c","type":"switch","z":"64672e75.03f4a8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":410,"y":560,"wires":[["c11bb4dd.84b3f"],["c11bb4dd.84b3f"],["9be6c47a.6a94f","cd0ceb27.ad777"],["3be3c18b.3156ee","f6371b8f.ce0d1"]]},{"id":"6926ac7a.6a98dc","type":"set-shared-state","z":"64672e75.03f4a8","state":"ddc00501.5975f8","name":"relay1","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":970,"y":500,"wires":[]},{"id":"53d30698.598b","type":"set-shared-state","z":"64672e75.03f4a8","state":"b57179f0.c9eaa","name":"relay2","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":930,"y":640,"wires":[]},{"id":"c11bb4dd.84b3f","type":"change","z":"64672e75.03f4a8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":520,"wires":[["6926ac7a.6a98dc","53d30698.598b"]]},{"id":"3be3c18b.3156ee","type":"change","z":"64672e75.03f4a8","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":640,"wires":[["6926ac7a.6a98dc"]]},{"id":"9be6c47a.6a94f","type":"change","z":"64672e75.03f4a8","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":580,"wires":[["6926ac7a.6a98dc"]]},{"id":"cd0ceb27.ad777","type":"change","z":"64672e75.03f4a8","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":700,"wires":[["53d30698.598b"]]},{"id":"f6371b8f.ce0d1","type":"change","z":"64672e75.03f4a8","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":760,"wires":[["53d30698.598b"]]},{"id":"4bc853ce.08eac4","type":"switch","z":"d7e822af.c12a4","name":"If MODE","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":300,"y":80,"wires":[["d678235c.eb80c8"]]},{"id":"7a372047.0c825","type":"switch","z":"d7e822af.c12a4","name":"","property":"state.coolerPID.value","propertyType":"global","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":1150,"y":420,"wires":[["97674649.be05e8","7bb1e955.a8d99","e36a418.27eabc"]]},{"id":"67048c6a.78d4bc","type":"switch","z":"d7e822af.c12a4","name":"","property":"state.heaterPID.value","propertyType":"global","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":620,"wires":[["93fb3f24.682bf","1ee5d6c.4e64429","a1ee4f29.bb8d38"]]},{"id":"41568ff4.7b9a68","type":"set-shared-state","z":"d7e822af.c12a4","state":"e06ffb1d.7fc6a","name":"chamberState","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":1560,"y":420,"wires":[]},{"id":"e36a418.27eabc","type":"change","z":"d7e822af.c12a4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1340,"y":420,"wires":[["41568ff4.7b9a68"]]},{"id":"f3b0e8eb.04d208","type":"debug","z":"64672e75.03f4a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1150,"y":180,"wires":[]},{"id":"68ed205b.854af","type":"function","z":"a8a3abf.e25bad8","name":"30 sec RC + 20","func":"// Applies a simple RC low pass filter to incoming payload values\nvar tc = 30*1000;       // time constant in milliseconds\n\nvar lastValue = context.get('lastValue');\nif (typeof lastValue == \"undefined\") lastValue = msg.payload;\nvar lastTime = context.get('lastTime') || null;\nvar now = new Date();\nvar currentValue = msg.payload;\nif (lastTime === null) {\n    // first time through\n    newValue = currentValue;\n} else {\n    var dt = now - lastTime;\n    var newValue;\n    \n    if (dt > 0) {\n        var dtotc = dt / tc;\n        newValue = lastValue * (1 - dtotc) + currentValue * dtotc;\n    } else {\n        // no time has elapsed leave output the same as last time\n        newValue = lastValue;\n    }\n}\ncontext.set('lastValue', newValue);\ncontext.set('lastTime', now);\n\nmsg.payload = newValue + 20;\nreturn msg;","outputs":1,"noerr":0,"x":626.5,"y":207,"wires":[["11fc8064.92484"]]},{"id":"f2f1bec6.236258","type":"inject","z":"a8a3abf.e25bad8","name":"Inject -0.2 at start","repeat":"","crontab":"","once":true,"topic":"","payload":"-0.2","payloadType":"num","x":134.5,"y":30,"wires":[["64ab43cf.6e5e4c"]]},{"id":"b9306c61.07beb","type":"function","z":"a8a3abf.e25bad8","name":"10 sec RC","func":"// Applies a simple RC low pass filter to incoming payload values\nvar tc = 10*1000;       // time constant in milliseconds\n\nvar lastValue = context.get('lastValue');\nif (typeof lastValue == \"undefined\") lastValue = msg.payload;\nvar lastTime = context.get('lastTime') || null;\nvar now = new Date();\nvar currentValue = msg.payload;\nif (lastTime === null) {\n    // first time through\n    newValue = currentValue;\n} else {\n    var dt = now - lastTime;\n    var newValue;\n    \n    if (dt > 0) {\n        var dtotc = dt / tc;\n        newValue = lastValue * (1 - dtotc) + currentValue * dtotc;\n    } else {\n        // no time has elapsed leave output the same as last time\n        newValue = lastValue;\n    }\n}\ncontext.set('lastValue', newValue);\ncontext.set('lastTime', now);\n\nmsg.payload = newValue;\nreturn msg;","outputs":1,"noerr":0,"x":451,"y":207,"wires":[["68ed205b.854af"]]},{"id":"64ab43cf.6e5e4c","type":"delay","z":"a8a3abf.e25bad8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":268,"y":104,"wires":[["59b25e00.d8d11"]]},{"id":"9d2b27f9.2ddd78","type":"function","z":"a8a3abf.e25bad8","name":"2 msg transport delay","func":"// stores messages in a fifo until the specified number have been received, \n// then releases them as new messages are received.\n// during the filling phase the earliest message is passed on each time \n// a message is received, but it is also left in the fifo\nvar fifoMaxLength = 2;\nvar fifo = context.get('fifo') || [];\n// push the new message onto the top of the array, messages are shifted down and\n// drop off the front\nvar length = fifo.push(msg);  // returns new length\nif (length > fifoMaxLength) {\n    newMsg = fifo.shift();\n} else {\n    // not full yet, make a copy of the msg and pass it on\n    var newMsg = JSON.parse(JSON.stringify(fifo[0]));\n}\ncontext.set('fifo', fifo);\nreturn newMsg;","outputs":1,"noerr":0,"x":258,"y":208,"wires":[["b9306c61.07beb"]]},{"id":"11fc8064.92484","type":"function","z":"a8a3abf.e25bad8","name":"Clear all except payload","func":"msg2 = {payload: msg.payload};\nreturn msg2;","outputs":1,"noerr":0,"x":545,"y":293,"wires":[[]]},{"id":"59b25e00.d8d11","type":"range","z":"a8a3abf.e25bad8","minin":"0","maxin":"1","minout":"0","maxout":"100","action":"scale","round":false,"name":"","x":87,"y":208,"wires":[["9d2b27f9.2ddd78"]]},{"id":"17e34d7a.640133","type":"PID","z":"604b5693.eede3","name":"","setpoint":"20","pb":"22","ti":"24","td":"6","integral_default":"0","smooth_factor":"0","max_interval":600,"enable":"1","disabled_op":"0","x":570,"y":320,"wires":[["e4cc4c72.4a2338","36cfce4e.bf6a22"]]},{"id":"bff0256e.b10528","type":"change","z":"604b5693.eede3","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"op","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":809.5,"y":395,"wires":[["f3cce226.ee2c38"]]},{"id":"ecc212a9.63ed18","type":"inject","z":"604b5693.eede3","name":"Setpoint 30","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":"","topic":"setpoint","payload":"15","payloadType":"num","x":312,"y":343,"wires":[["17e34d7a.640133"]]},{"id":"a2687fec.4d3118","type":"inject","z":"604b5693.eede3","name":"Setpoint 80","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":"","topic":"setpoint","payload":"25","payloadType":"num","x":310.5,"y":392,"wires":[["17e34d7a.640133"]]},{"id":"e13aab52.0b4fa8","type":"inject","z":"604b5693.eede3","name":"enable","repeat":"","crontab":"","once":false,"topic":"enable","payload":"true","payloadType":"bool","x":303,"y":228,"wires":[["17e34d7a.640133"]]},{"id":"6b6420c.2061f6","type":"inject","z":"604b5693.eede3","name":"disable","repeat":"","crontab":"","once":false,"topic":"enable","payload":"false","payloadType":"bool","x":303.5,"y":278,"wires":[["17e34d7a.640133"]]},{"id":"dbc1fe02.b85fc8","type":"subflow:a8a3abf.e25bad8","z":"604b5693.eede3","x":540,"y":120,"wires":[["bd1b8173.c44378"]]},{"id":"bd1b8173.c44378","type":"change","z":"604b5693.eede3","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"pv","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":794,"y":246,"wires":[["f3cce226.ee2c38"]]},{"id":"e4cc4c72.4a2338","type":"range","z":"604b5693.eede3","minin":"0","maxin":"1","minout":"0","maxout":"25","action":"scale","round":false,"property":"payload","name":"Scale power","x":635,"y":395,"wires":[["bff0256e.b10528"]]},{"id":"f3cce226.ee2c38","type":"ui_chart","z":"604b5693.eede3","name":"","group":"97a76c62.524858","order":4,"width":"6","height":"6","label":"chart","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"100","removeOlder":"3","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#cf0005","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1050,"y":320,"wires":[[]]},{"id":"361429cd.84208e","type":"inject","z":"604b5693.eede3","name":"Clear chart on deploy","repeat":"","crontab":"","once":true,"topic":"","payload":"{\"data\":[]}","payloadType":"json","x":560,"y":463,"wires":[["bff84182.c269"]]},{"id":"bff84182.c269","type":"change","z":"604b5693.eede3","name":"","rules":[{"t":"move","p":"payload.data","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":796,"y":463,"wires":[["f3cce226.ee2c38"]]},{"id":"3b05a8ba.7c7c68","type":"debug","z":"604b5693.eede3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":980,"y":200,"wires":[]},{"id":"36cfce4e.bf6a22","type":"function","z":"604b5693.eede3","name":"Split Heat/Cool","func":"/* A function designed to be used with node-red-contrib-pid in applications where both\n * heating and cooling are available to control the system.\n * The node is given a power value in msg.payload in the range 0 to 1, such as is produced by \n * node-red-contrib-pid and splits this into a heat power (o/p 1) and cool power (o/p 2) where\n * each is in the range 0 to 1.  These can then be fed directly into an output device, if this\n * is continuously variable, or they may be passed to node-red-contrib-timeprop nodes to generate\n * time proportioned on/off outputs.\n * There are two particular issues to be dealt with in a heat/cool application. Firstly is the fact\n * that the cooling device may be more or less powerful than the heating device. It is necessary\n * therefore to be able to adjust the gain of the system separately for heating and cooling. Secondly\n * is the highly non-linear response of some devices, notably refrigerant systems, that can have a\n * large effect initially, then this tails off. To compensate for this it is useful to have an \n * overlap range where both heat and cool are slightly on.\n *\n * To allow for these requirements two variables can be set below. The value of the power input value\n * where the heating starts to come on is determined by the variable heatMin.  Above this value the\n * heating will rise till it is fully on with an input of 1.\n * The cooling is fully on when value of the power input is 0, and falls till the cooling is fully\n * off at an input of coolMin.\n *\n * If the heating and cooling systems are of similar power then set heatMin and coolMin both to 0.5\n * in which case input values of 0.5 to 1.0 will map to heating outputs of 0.0 to 1.0,\n * and 0.5 down to 0.0 will map to cooling 0.0 to 1.0.\n * If, for example, the cooling system is more powerful than heating then they can both be set\n * to something like 0.7 which increases the gain in the heating region and reduces it\n * in the cooling region, to compensate for the different powers in the heating/cooling systems.\n * If some overlap is desired (so that both heat and cool are on slightly near the crossover\n * point) then overlap the two settings so that, for example, heatMin might be 0.45 and coolMin\n * might be 0.55\n */\n\n// set these as described above\nvar heatMin = 0.5;          // the value of input corresponding to 0 heat o/p\nvar coolMin = 0.5;          // the value of input corresponding to 0 cool o/p\n    \nvar power = msg.payload;\nvar heat = (power - heatMin)/(1 - heatMin);\n// limit to range 0 to 1\nheat = Math.min(Math.max(heat, 0), 1);\nvar cool = (coolMin - power) / coolMin;\n// limit to range 0 to 1\ncool = Math.min(Math.max(cool, 0), 1);\nreturn [{payload: heat}, {payload: cool}];\n","outputs":"2","noerr":0,"initialize":"","finalize":"","x":920,"y":580,"wires":[["3c5f0a2f.fc7b46"],["571daa27.47258c"]]},{"id":"571daa27.47258c","type":"debug","z":"604b5693.eede3","name":"Cool","active":true,"console":"false","complete":"payload","x":1124.5,"y":594,"wires":[]},{"id":"3c5f0a2f.fc7b46","type":"debug","z":"604b5693.eede3","name":"Heat","active":true,"console":"false","complete":"payload","x":1124,"y":550,"wires":[]},{"id":"d2c59a50.7b1a8","type":"comment","z":"604b5693.eede3","name":"To heater","info":"","x":1100,"y":515,"wires":[]},{"id":"b0db0abb.c6a8d","type":"comment","z":"604b5693.eede3","name":"To Cooler","info":"","x":1099,"y":632,"wires":[]},{"id":"35d58b7b.e4a0bc","type":"change","z":"64672e75.03f4a8","name":"Prepare message for DAC","rules":[{"t":"set","p":"topic","pt":"msg","to":"tinkerforge/request/analog_out_v2_bricklet/vm5/set_output_voltage","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":420,"wires":[["6e756ef9.f8e908"]]},{"id":"6e756ef9.f8e908","type":"template","z":"64672e75.03f4a8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"voltage\": {{payload}} }","output":"str","x":780,"y":400,"wires":[["2edb92ac.0ac33e"]]},{"id":"c51f5e58.5226f","type":"ui_chart","z":"c080d81d.548348","name":"","group":"8f8583e.f5aeb8","order":3,"width":0,"height":0,"label":"chart","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"25","ymax":"30","removeOlder":"50","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1230,"y":160,"wires":[[]]},{"id":"1a69be0a.5d9cb2","type":"mqtt out","z":"64672e75.03f4a8","name":"","topic":"tinkerforge/request/industrial_dual_relay_bricklet/FLM/set_value","qos":"","retain":"","broker":"74dcdab5.83e964","x":900,"y":100,"wires":[]},{"id":"4441a7ff.ccde","type":"template","z":"64672e75.03f4a8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"channel0\":{{global.state.relay1.value}},\"channel1\":{{global.state.relay2.value}}}","output":"str","x":420,"y":100,"wires":[["1a69be0a.5d9cb2"]]},{"id":"39f59899.df5af","type":"inject","z":"64672e75.03f4a8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":40,"wires":[["4441a7ff.ccde"]]},{"id":"4a462bcf.ac9abc","type":"ui_numeric","z":"d7e822af.c12a4","name":"","label":"PID","tooltip":"","group":"97a76c62.524858","order":7,"width":0,"height":0,"wrap":false,"passthru":false,"topic":"photon/cmd/DAC","format":"{{value}}","min":"0","max":"0","step":"0.0001","x":1350,"y":300,"wires":[[]]},{"id":"57e3fc8b.20cc04","type":"PID","z":"d7e822af.c12a4","name":"Global PID","setpoint":"20","pb":"1.3","ti":"600","td":"150","integral_default":"0","smooth_factor":"2","max_interval":600,"enable":"1","disabled_op":"0","x":530,"y":860,"wires":[["44ee3075.fe1648","4412325d.4e1ff4"]]},{"id":"e90b6a97.4ef6","type":"change","z":"144fdae.df77825","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"[9]","tot":"bin"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":360,"wires":[["c03a4710.1bffe8"]]},{"id":"c03a4710.1bffe8","type":"link out","z":"144fdae.df77825","name":"send-switch-off","links":["e3b617d9.1e80f"],"x":975,"y":440,"wires":[]},{"id":"8ae85e41.5dd94","type":"set-shared-state","z":"144fdae.df77825","state":"e06ffb1d.7fc6a","name":"chamberState","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":790,"y":300,"wires":[]},{"id":"35da4b8f.1332b4","type":"set-shared-state","z":"144fdae.df77825","state":"e06ffb1d.7fc6a","name":"chamberState","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":770,"y":220,"wires":[]},{"id":"9b77bb1c.b7286","type":"ui_button","z":"144fdae.df77825","name":"Start","group":"fc3775f5.c6257","order":1,"width":3,"height":2,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-3x fa-play","payload":"2","payloadType":"num","topic":"","x":500,"y":300,"wires":[["8ae85e41.5dd94"]]},{"id":"ad729b28.f7d84","type":"ui_button","z":"144fdae.df77825","name":"Stop","group":"fc3775f5.c6257","order":9,"width":3,"height":2,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-3x fa-stop","payload":"1","payloadType":"num","topic":"","x":500,"y":220,"wires":[["35da4b8f.1332b4"]]},{"id":"6284801f.89875","type":"ui_button","z":"144fdae.df77825","name":"OFF","group":"fc3775f5.c6257","order":13,"width":4,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-3x fa-power-off ","payload":"1","payloadType":"num","topic":"","x":500,"y":360,"wires":[["35da4b8f.1332b4","e90b6a97.4ef6"]]},{"id":"d5681a9f.d2114","type":"change","z":"d7e822af.c12a4","name":"Enable","rules":[{"t":"set","p":"enable","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"setpoint","pt":"msg","to":"state.setpoint.value","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":860,"wires":[["57e3fc8b.20cc04"]]},{"id":"44ee3075.fe1648","type":"switch","z":"d7e822af.c12a4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"0.5","vt":"num"},{"t":"gte","v":"0.5","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":700,"wires":[[],[]]},{"id":"4412325d.4e1ff4","type":"function","z":"d7e822af.c12a4","name":"Split Heat/Cool","func":"/* A function designed to be used with node-red-contrib-pid in applications where both\n * heating and cooling are available to control the system.\n * The node is given a power value in msg.payload in the range 0 to 1, such as is produced by \n * node-red-contrib-pid and splits this into a heat power (o/p 1) and cool power (o/p 2) where\n * each is in the range 0 to 1.  These can then be fed directly into an output device, if this\n * is continuously variable, or they may be passed to node-red-contrib-timeprop nodes to generate\n * time proportioned on/off outputs.\n * There are two particular issues to be dealt with in a heat/cool application. Firstly is the fact\n * that the cooling device may be more or less powerful than the heating device. It is necessary\n * therefore to be able to adjust the gain of the system separately for heating and cooling. Secondly\n * is the highly non-linear response of some devices, notably refrigerant systems, that can have a\n * large effect initially, then this tails off. To compensate for this it is useful to have an \n * overlap range where both heat and cool are slightly on.\n *\n * To allow for these requirements two variables can be set below. The value of the power input value\n * where the heating starts to come on is determined by the variable heatMin.  Above this value the\n * heating will rise till it is fully on with an input of 1.\n * The cooling is fully on when value of the power input is 0, and falls till the cooling is fully\n * off at an input of coolMin.\n *\n * If the heating and cooling systems are of similar power then set heatMin and coolMin both to 0.5\n * in which case input values of 0.5 to 1.0 will map to heating outputs of 0.0 to 1.0,\n * and 0.5 down to 0.0 will map to cooling 0.0 to 1.0.\n * If, for example, the cooling system is more powerful than heating then they can both be set\n * to something like 0.7 which increases the gain in the heating region and reduces it\n * in the cooling region, to compensate for the different powers in the heating/cooling systems.\n * If some overlap is desired (so that both heat and cool are on slightly near the crossover\n * point) then overlap the two settings so that, for example, heatMin might be 0.45 and coolMin\n * might be 0.55\n */\n\n// set these as described above\nvar heatMin = 0.5;          // the value of input corresponding to 0 heat o/p\nvar coolMin = 0.5;          // the value of input corresponding to 0 cool o/p\n    \nvar power = msg.payload;\nvar heat = (power - heatMin)/(1 - heatMin);\n// limit to range 0 to 1\nheat = Math.min(Math.max(heat, 0), 1);\nvar cool = (coolMin - power) / coolMin;\n// limit to range 0 to 1\ncool = Math.min(Math.max(cool, 0), 1);\nreturn [{payload: heat}, {payload: cool}];\n","outputs":"2","noerr":0,"initialize":"","finalize":"","x":740,"y":840,"wires":[[],[]]},{"id":"65542722.b2a6c8","type":"debug","z":"d7e822af.c12a4","name":"Cool","active":true,"console":"false","complete":"payload","x":1044.5,"y":914,"wires":[]},{"id":"f1df7050.1f3b98","type":"debug","z":"d7e822af.c12a4","name":"Heat","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1044,"y":870,"wires":[]},{"id":"9e981823.d11498","type":"comment","z":"d7e822af.c12a4","name":"To heater","info":"","x":1240,"y":900,"wires":[]},{"id":"2b1b23f.027a5dc","type":"comment","z":"d7e822af.c12a4","name":"To Cooler","info":"","x":1220,"y":960,"wires":[]},{"id":"7f56673.d91be18","type":"ui_button","z":"144fdae.df77825","name":"Up","group":"fc3775f5.c6257","order":3,"width":3,"height":2,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-3x fa-arrow-up","payload":"1","payloadType":"num","topic":"","x":450,"y":540,"wires":[["e98648b4.2c14"]]},{"id":"563a2958.ebefa8","type":"ui_button","z":"144fdae.df77825","name":"Down","group":"fc3775f5.c6257","order":5,"width":3,"height":2,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-3x fa-arrow-down","payload":"-1","payloadType":"num","topic":"","x":450,"y":580,"wires":[["e98648b4.2c14"]]},{"id":"13657f74.3fab09","type":"ui_gauge","z":"144fdae.df77825","name":"","group":"fc3775f5.c6257","order":8,"width":5,"height":4,"gtype":"gage","title":"Chamber Temp","label":"units","format":"{{value}}","min":"10","max":"40","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":980,"y":560,"wires":[]},{"id":"16fad620.8a1b62","type":"ui_text","z":"144fdae.df77825","group":"fc3775f5.c6257","order":4,"width":3,"height":2,"name":"","label":"","format":"<font size=10>{{msg.payload}}C","layout":"row-spread","x":510,"y":460,"wires":[]},{"id":"84fd9434.8f731","type":"get-shared-state","z":"144fdae.df77825","state":"defdd5c9.00f138","name":"setpoint","triggerOnInit":true,"x":210,"y":440,"wires":[["16fad620.8a1b62"]]},{"id":"7877d07a.7552c","type":"set-shared-state","z":"144fdae.df77825","state":"defdd5c9.00f138","name":"setpoint","triggerOnInit":true,"provideOutput":false,"outputs":0,"x":820,"y":600,"wires":[]},{"id":"e98648b4.2c14","type":"function","z":"144fdae.df77825","name":"","func":"var setpoint = global.get('state.setpoint.value');\n\nmsg.payload = setpoint + msg.payload;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":560,"wires":[["7877d07a.7552c"]]},{"id":"9133995c.e4b3a","type":"change","z":"144fdae.df77825","name":"","rules":[{"t":"set","p":"state.setpoint.value","pt":"global","to":"setpoint","tot":"msg"},{"t":"set","p":"state.setpoint.value","pt":"global","to":"{msg.setpoint} + {msg.paylod}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":660,"wires":[[]]},{"id":"2be5b839.543b8","type":"rpi-mouse","z":"144fdae.df77825","name":"","butt":"1","x":170,"y":60,"wires":[["99efd87c.6cb74","10ba7482.305cdb"]]},{"id":"30860dea.6971c2","type":"exec","z":"144fdae.df77825","command":"sudo sh -c 'echo \"1\" > /sys/class/backlight/rpi_backlight/bl_power'","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":910,"y":80,"wires":[[],[],[]]},{"id":"99efd87c.6cb74","type":"trigger","z":"144fdae.df77825","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"30","extend":true,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":470,"y":60,"wires":[["30860dea.6971c2"]]},{"id":"10ba7482.305cdb","type":"exec","z":"144fdae.df77825","command":"sudo sh -c 'echo \"0\" > /sys/class/backlight/rpi_backlight/bl_power'","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":900,"y":140,"wires":[[],[],[]]},{"id":"ae9d4c4c.6eec8","type":"ui_chart","z":"144fdae.df77825","name":"","group":"d2fe52dd.9e871","order":1,"width":"14","height":"7","label":"chart","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":950,"y":720,"wires":[[]]},{"id":"2d48f21e.f9e146","type":"get-shared-state","z":"144fdae.df77825","state":"6084ef9b.c26b6","name":"chamberTemp","triggerOnInit":true,"x":660,"y":740,"wires":[["ae9d4c4c.6eec8"]]},{"id":"29c71959.214766","type":"ui_template","z":"144fdae.df77825","group":"472f2b70.fd328c","name":"Dashboard stylesheet","order":1,"width":0,"height":0,"format":"<style>\n/*\nIt is reasnoble to declare the colors as CSS variables\nso they can be easily called by name where needed.\n\nYou can see that in many places the variables are not used. Change it!\n*/\n\n:root {\n  --color-green-primary: rgb(51, 204, 51);\n  --color-green-secondary: rgb(26, 101, 26);\n  --color-red-primary: rgb(255, 0, 0);\n  --color-red-secondary: rgba(153,0,0,1);\n  --color-gray-primary:rgba(40,40,40,1);\n  --color-gray-secondary:rgba(65,65,65,1);\n  --color-text-primary: rgb(230, 226, 209);\n  --color-widget-border: rgb(84, 78, 78);\n}\n\n/*\nAll CSS adjustments are commented out.\nTurn rules on one by one and see the changes.\nDon't use too many elements cos it wil be confusing\nStart with simple elements like text, slider or button\n\nMany of elements like buttons have states, \nthose rules must be found and adjusted also.\n*/\n\n\n.masonry-container {\n    position: relative;\n    width: 100%;\n    height:100%;\n    margin: 0 auto;\n    background: rgb(255,0,0);\n    background: linear-gradient(180deg,  var(--color-gray-primary) 0%, var(--color-gray-secondary) 100%);\n}\n\n.nr-dashboard-cardcontainer {\n    position: relative;\n    box-shadow: inset 0px 1px 4px 0px #000000bb;\n    border-radius: 15px;\n}\n\n.nr-dashboard-theme ui-card-panel {\n    background-color: #33333300;\n    color:var(--color-text-primary);\n    border-radius: 15px;\n    box-shadow: 0 0 8px 0px #00000080;\n}\n\nbody.nr-dashboard-theme md-content md-card {\n    background-color: #33333300;\n    color: var(--color-text-primary);\n    text-shadow: 4px 2px 4px #00000045;\n    box-shadow: 0 -1px 5px 1px #00000045;\n    border-radius: 12px;\n    border: 1px solid var(--color-widget-border);\n}\n\n.nr-dashboard-theme ui-card-panel p.nr-dashboard-cardtitle {\n    color: var(--color-text-primary);\n}\n\n.md-button {\n    display: inline-block;\n    position: relative;\n    cursor: pointer;\n    min-height: 36px;\n    min-width: 88px;\n    line-height: 36px;\n    vertical-align: middle;\n    align-items: center;\n    text-align: center;\n    border-radius: 12px;\n    box-sizing: border-box;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    outline: none;\n    border: 0;\n    padding: 0 6px;\n    margin: 6px 8px;\n    background: transparent;\n    color:var(--color-text-primary);\n    white-space: nowrap;\n    text-transform: uppercase;\n    font-weight: 500;\n    font-size: 14px;\n    font-style: inherit;\n    font-variant: inherit;\n    font-family: inherit;\n    text-decoration: none;\n    overflow: hidden;\n    transition: box-shadow .4s cubic-bezier(.25,.8,.25,1),background-color .4s cubic-bezier(.25,.8,.25,1);\n}\n\n\n.nr-dashboard-theme .nr-dashboard-button .md-button {\n    background-color: #88888800;\n    color:var(--color-text-primary);\n}\n\n.nr-dashboard-theme .nr-dashboard-button .md-button:hover {\n    background-color: #88888855;\n}\n\nmd-slider .md-thumb {\n    z-index: 1;\n    position: absolute;\n    left: -10px;\n    top: 14px;\n    width: 20px;\n    height: 20px;\n    border-radius: 20px;\n    -webkit-transform: scale(.7);\n    transform: scale(.7);\n    transition: all .4s cubic-bezier(.25,.8,.25,1);\n    box-shadow: 0 0 6px #00000070;\n}\n\n\n/*\nAdvanced stuff - dynamic change of card CSS\n\nClasses here can be used to make colored stripe at the top of card\nUsage is not in here, but they are added to md-card when needed within another template\n\n.carderr {\n    background: rgb(255,0,0);\n    background: linear-gradient(180deg, var(--color-red-primary) 0px, var(--color-red-secondary) 3px, rgba(80,80,80,1) 4px, rgba(45,45,45,1) 100%);\n}\n.cardok {\n    background: rgb(39,255,0);\n    background: linear-gradient(180deg, var(--color-green-primary) 0px, var(--color-green-secondary) 3px, rgba(70,70,70,1) 4px, rgba(40,40,40,1) 100%);\n}\n*/\n\n</style>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"global","x":1180,"y":300,"wires":[[]]}]